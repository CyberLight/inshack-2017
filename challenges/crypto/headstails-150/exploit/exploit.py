#!/usr/bin/python3
from pwn import *

host = "headstails.insecurity-insa.fr"

def alive():
    s = ssh(host=host, user="headstails", password="headstails", level="error")
    conn = s.shell()
    res = conn.recvuntil("Welcome")
    conn.send("\x03") # ctrl-c
    s.close()
    return res == b'Welcome'

def exploitable():
    s = ssh(host=host, user="headstails", password="headstails", level="error")
    conn = s.shell()
    res = conn.recvuntil('4.Exit')
    conn.sendline('1')
    for i in range(100):
        conn.recvuntil("your play !\r\n")
        conn.sendline('00OooooOOOoOooO00ooo0')
        if b'heads' in conn.recvuntil('sending your play'):
            conn.sendline('155171heads')
        else:
            conn.sendline('146262tails')
    conn.recvuntil('your flag')
    conn.send("\x03") # ctrl-c
    s.close()
    return b'INSA{' in conn.recvline()

if __name__ == "__main__":
    print(alive() and exploitable())
