#!/usr/bin/python3

import requests
import hashlib

testing = False
zip_url = 'https://drive.google.com/uc?export=download&id=0BzPQ2skYzQgeeHdYamNoaktZQ1E'
api_url = 'https://smartsensors.insecurity-insa.fr/'

def alive():
    try:
        if testing:
            if "Your post data must" in requests.post('http://localhost:2052/').text:
                return True
        else:
            if "Your post data must" in requests.post(api_url).text:
                return True
    except:
        return False
    return False

def exploit():
    """see writeup.md for a detailed description of what needs to be done and a script extract"""
    if testing:
        with open('../public-files/backup.zip', 'rb') as f:
            content = f.read()
    else:
        resp = requests.get(zip_url)
        content = resp.content
    md5_returned = hashlib.md5(content).hexdigest()
    if md5_returned != "ef8f0097721457aaa1da5fd683d3c5c5":
        return False
    return True

if __name__ == "__main__":
    print(alive() and exploit())
