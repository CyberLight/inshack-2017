#!/usr/bin/python3
import requests
import re
import hashlib


url = "https://dga.insecurity-insa.fr"

def alive():
    response = requests.get(url + "/dga.pcapng")
    sha256_returned = hashlib.sha256(response.content).hexdigest()
    if(sha256_returned != "101f4b9d5c7aa2f7df4f3d1ebb0ccc815f2b64418ae62e5ce0cf50f78d420c87"):
        return False
    return True


def exploitable():
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'
    }
    r = requests.get('https://www.ietf.org/rfc/rfc3920.txt',headers)
    text = r.text
    result = re.compile('\w+').findall(text)
    currentTime = 1510138800
    hashResult = int(hashlib.sha1(str(currentTime).encode("utf-8")).hexdigest(), 16)% (10 ** 9)
    posWord1 = hashResult//(10**6)
    posWord2 = (hashResult % (10**6))//(10**3)
    posWord3 = hashResult % (10**3)
    resultDomain = 'http://'+result[posWord1%300].lower()+result[posWord2%300].lower()+result[posWord3%300].lower()+'.fr'
    data = {
        'name':resultDomain,
    }
    r = requests.post(url + '/screen',json=data)
    if r.text != "{\"location\":\"INSA{I_l0v3_Dg4_w1th_shA1}\"}":
        return False
    return True


if __name__ == "__main__":
    print(alive() and exploitable())

